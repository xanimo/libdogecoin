<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdogecoin: src/libevent/ratelim-internal.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libdogecoin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_97979c17d049e8002d2e089c4964ead4.html">libevent</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">ratelim-internal.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;event2/util.h&quot;</code><br />
</div>
<p><a href="ratelim-internal_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structev__token__bucket.html">ev_token_bucket</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structev__token__bucket__cfg.html">ev_token_bucket_cfg</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a891f18b04373bbad79d768896d345a97"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ratelim-internal_8h.html#a891f18b04373bbad79d768896d345a97">ev_token_bucket_decrement_read</a>(b,  n)</td></tr>
<tr class="separator:a891f18b04373bbad79d768896d345a97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a851a6aee5aabeb519208ae437136d239"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ratelim-internal_8h.html#a851a6aee5aabeb519208ae437136d239">ev_token_bucket_decrement_write</a>(b,  n)</td></tr>
<tr class="separator:a851a6aee5aabeb519208ae437136d239"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a47c8b7c18203a995cbbd368d3f997938"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ratelim-internal_8h.html#a47c8b7c18203a995cbbd368d3f997938">ev_token_bucket_update_</a> (struct <a class="el" href="structev__token__bucket.html">ev_token_bucket</a> *bucket, const struct <a class="el" href="structev__token__bucket__cfg.html">ev_token_bucket_cfg</a> *cfg, ev_uint32_t current_tick)</td></tr>
<tr class="separator:a47c8b7c18203a995cbbd368d3f997938"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7131ff343925cff5f5235ebbe6e332b"><td class="memItemLeft" align="right" valign="top">ev_uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ratelim-internal_8h.html#af7131ff343925cff5f5235ebbe6e332b">ev_token_bucket_get_tick_</a> (const struct timeval *tv, const struct <a class="el" href="structev__token__bucket__cfg.html">ev_token_bucket_cfg</a> *cfg)</td></tr>
<tr class="separator:af7131ff343925cff5f5235ebbe6e332b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3efd9dbac768fc7d86cb77c688c8456d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ratelim-internal_8h.html#a3efd9dbac768fc7d86cb77c688c8456d">ev_token_bucket_init_</a> (struct <a class="el" href="structev__token__bucket.html">ev_token_bucket</a> *bucket, const struct <a class="el" href="structev__token__bucket__cfg.html">ev_token_bucket_cfg</a> *cfg, ev_uint32_t current_tick, int reinitialize)</td></tr>
<tr class="separator:a3efd9dbac768fc7d86cb77c688c8456d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ff502cad4f14581ddc40f5223279dfa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ratelim-internal_8h.html#a9ff502cad4f14581ddc40f5223279dfa">bufferevent_remove_from_rate_limit_group_internal_</a> (struct bufferevent *bev, int unsuspend)</td></tr>
<tr class="separator:a9ff502cad4f14581ddc40f5223279dfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a891f18b04373bbad79d768896d345a97" name="a891f18b04373bbad79d768896d345a97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a891f18b04373bbad79d768896d345a97">&#9670;&nbsp;</a></span>ev_token_bucket_decrement_read</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ev_token_bucket_decrement_read</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">n&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">do</span> {                    \</div>
<div class="line">        (b)-&gt;read_limit -= (n);     \</div>
<div class="line">    } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment --><p >Decrease the read limit of 'b' by 'n' bytes </p>

<p class="definition">Definition at line <a class="el" href="ratelim-internal_8h_source.html#l00091">91</a> of file <a class="el" href="ratelim-internal_8h_source.html">ratelim-internal.h</a>.</p>

</div>
</div>
<a id="a851a6aee5aabeb519208ae437136d239" name="a851a6aee5aabeb519208ae437136d239"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a851a6aee5aabeb519208ae437136d239">&#9670;&nbsp;</a></span>ev_token_bucket_decrement_write</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ev_token_bucket_decrement_write</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">n&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">do</span> {                    \</div>
<div class="line">        (b)-&gt;write_limit -= (n);    \</div>
<div class="line">    } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment --><p >Decrease the write limit of 'b' by 'n' bytes </p>

<p class="definition">Definition at line <a class="el" href="ratelim-internal_8h_source.html#l00096">96</a> of file <a class="el" href="ratelim-internal_8h_source.html">ratelim-internal.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a9ff502cad4f14581ddc40f5223279dfa" name="a9ff502cad4f14581ddc40f5223279dfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ff502cad4f14581ddc40f5223279dfa">&#9670;&nbsp;</a></span>bufferevent_remove_from_rate_limit_group_internal_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int bufferevent_remove_from_rate_limit_group_internal_ </td>
          <td>(</td>
          <td class="paramtype">struct bufferevent *&#160;</td>
          <td class="paramname"><em>bev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>unsuspend</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="bufferevent__ratelim_8c_source.html#l00787">787</a> of file <a class="el" href="bufferevent__ratelim_8c_source.html">bufferevent_ratelim.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  789</span>{</div>
<div class="line"><span class="lineno">  790</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structbufferevent__private.html">bufferevent_private</a> *bevp = <a class="code hl_define" href="bufferevent-internal_8h.html#a50603e7195cdaee52020d30b6f4f5c94">BEV_UPCAST</a>(<a class="code hl_variable" href="structbufferevent__private.html#a7d793f0632346c32119b818783b97c41">bev</a>);</div>
<div class="line"><span class="lineno">  791</span>    <a class="code hl_define" href="bufferevent-internal_8h.html#a08b6651a207b67183866ec2ccc899c9c">BEV_LOCK</a>(<a class="code hl_variable" href="structbufferevent__private.html#a7d793f0632346c32119b818783b97c41">bev</a>);</div>
<div class="line"><span class="lineno">  792</span>    <span class="keywordflow">if</span> (bevp-&gt;<a class="code hl_variable" href="structbufferevent__private.html#a4431ae35ad587a64c9f557c4bad3fae3">rate_limiting</a> &amp;&amp; bevp-&gt;<a class="code hl_variable" href="structbufferevent__private.html#a4431ae35ad587a64c9f557c4bad3fae3">rate_limiting</a>-&gt;<a class="code hl_variable" href="structbufferevent__rate__limit.html#ac7e81b36aedc37a0e403948168acc0f0">group</a>) {</div>
<div class="line"><span class="lineno">  793</span>        <span class="keyword">struct </span><a class="code hl_struct" href="structbufferevent__rate__limit__group.html">bufferevent_rate_limit_group</a> *g =</div>
<div class="line"><span class="lineno">  794</span>            bevp-&gt;<a class="code hl_variable" href="structbufferevent__private.html#a4431ae35ad587a64c9f557c4bad3fae3">rate_limiting</a>-&gt;<a class="code hl_variable" href="structbufferevent__rate__limit.html#ac7e81b36aedc37a0e403948168acc0f0">group</a>;</div>
<div class="line"><span class="lineno">  795</span>        <a class="code hl_define" href="bufferevent__ratelim_8c.html#a6b387f75332f7ff5b898c38b83169021">LOCK_GROUP</a>(g);</div>
<div class="line"><span class="lineno">  796</span>        bevp-&gt;<a class="code hl_variable" href="structbufferevent__private.html#a4431ae35ad587a64c9f557c4bad3fae3">rate_limiting</a>-&gt;<a class="code hl_variable" href="structbufferevent__rate__limit.html#ac7e81b36aedc37a0e403948168acc0f0">group</a> = NULL;</div>
<div class="line"><span class="lineno">  797</span>        --g-&gt;<a class="code hl_variable" href="structbufferevent__rate__limit__group.html#a273beb8e4c4660915ba76ec2e532378e">n_members</a>;</div>
<div class="line"><span class="lineno">  798</span>        LIST_REMOVE(bevp, rate_limiting-&gt;next_in_group);</div>
<div class="line"><span class="lineno">  799</span>        <a class="code hl_define" href="bufferevent__ratelim_8c.html#a260aef3cd7c11e76ca7e98947be0174c">UNLOCK_GROUP</a>(g);</div>
<div class="line"><span class="lineno">  800</span>    }</div>
<div class="line"><span class="lineno">  801</span>    <span class="keywordflow">if</span> (unsuspend) {</div>
<div class="line"><span class="lineno">  802</span>        <a class="code hl_function" href="bufferevent-internal_8h.html#a5754c572785bd31ec8f41c39681dc29f">bufferevent_unsuspend_read_</a>(bev, <a class="code hl_define" href="bufferevent-internal_8h.html#a916036b572e6b90f828f47f02707d2ef">BEV_SUSPEND_BW_GROUP</a>);</div>
<div class="line"><span class="lineno">  803</span>        <a class="code hl_function" href="bufferevent-internal_8h.html#a12fd1bcfa37cc063131fc982cca81b28">bufferevent_unsuspend_write_</a>(bev, <a class="code hl_define" href="bufferevent-internal_8h.html#a916036b572e6b90f828f47f02707d2ef">BEV_SUSPEND_BW_GROUP</a>);</div>
<div class="line"><span class="lineno">  804</span>    }</div>
<div class="line"><span class="lineno">  805</span>    <a class="code hl_define" href="bufferevent-internal_8h.html#ae4db92fe8e7d47c0402cd3fb6c5d3ea9">BEV_UNLOCK</a>(bev);</div>
<div class="line"><span class="lineno">  806</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  807</span>}</div>
<div class="ttc" id="abufferevent-internal_8h_html_a08b6651a207b67183866ec2ccc899c9c"><div class="ttname"><a href="bufferevent-internal_8h.html#a08b6651a207b67183866ec2ccc899c9c">BEV_LOCK</a></div><div class="ttdeci">#define BEV_LOCK(b)</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00485">bufferevent-internal.h:485</a></div></div>
<div class="ttc" id="abufferevent-internal_8h_html_a12fd1bcfa37cc063131fc982cca81b28"><div class="ttname"><a href="bufferevent-internal_8h.html#a12fd1bcfa37cc063131fc982cca81b28">bufferevent_unsuspend_write_</a></div><div class="ttdeci">void bufferevent_unsuspend_write_(struct bufferevent *bufev, bufferevent_suspend_flags what)</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent_8c_source.html#l00100">bufferevent.c:100</a></div></div>
<div class="ttc" id="abufferevent-internal_8h_html_a50603e7195cdaee52020d30b6f4f5c94"><div class="ttname"><a href="bufferevent-internal_8h.html#a50603e7195cdaee52020d30b6f4f5c94">BEV_UPCAST</a></div><div class="ttdeci">#define BEV_UPCAST(b)</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00478">bufferevent-internal.h:478</a></div></div>
<div class="ttc" id="abufferevent-internal_8h_html_a5754c572785bd31ec8f41c39681dc29f"><div class="ttname"><a href="bufferevent-internal_8h.html#a5754c572785bd31ec8f41c39681dc29f">bufferevent_unsuspend_read_</a></div><div class="ttdeci">EVENT2_EXPORT_SYMBOL void bufferevent_unsuspend_read_(struct bufferevent *bufev, bufferevent_suspend_flags what)</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent_8c_source.html#l00078">bufferevent.c:78</a></div></div>
<div class="ttc" id="abufferevent-internal_8h_html_a916036b572e6b90f828f47f02707d2ef"><div class="ttname"><a href="bufferevent-internal_8h.html#a916036b572e6b90f828f47f02707d2ef">BEV_SUSPEND_BW_GROUP</a></div><div class="ttdeci">#define BEV_SUSPEND_BW_GROUP</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00069">bufferevent-internal.h:69</a></div></div>
<div class="ttc" id="abufferevent-internal_8h_html_ae4db92fe8e7d47c0402cd3fb6c5d3ea9"><div class="ttname"><a href="bufferevent-internal_8h.html#ae4db92fe8e7d47c0402cd3fb6c5d3ea9">BEV_UNLOCK</a></div><div class="ttdeci">#define BEV_UNLOCK(b)</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00491">bufferevent-internal.h:491</a></div></div>
<div class="ttc" id="abufferevent__ratelim_8c_html_a260aef3cd7c11e76ca7e98947be0174c"><div class="ttname"><a href="bufferevent__ratelim_8c.html#a260aef3cd7c11e76ca7e98947be0174c">UNLOCK_GROUP</a></div><div class="ttdeci">#define UNLOCK_GROUP(g)</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent__ratelim_8c_source.html#l00186">bufferevent_ratelim.c:186</a></div></div>
<div class="ttc" id="abufferevent__ratelim_8c_html_a6b387f75332f7ff5b898c38b83169021"><div class="ttname"><a href="bufferevent__ratelim_8c.html#a6b387f75332f7ff5b898c38b83169021">LOCK_GROUP</a></div><div class="ttdeci">#define LOCK_GROUP(g)</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent__ratelim_8c_source.html#l00185">bufferevent_ratelim.c:185</a></div></div>
<div class="ttc" id="astructbufferevent__private_html"><div class="ttname"><a href="structbufferevent__private.html">bufferevent_private</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00154">bufferevent-internal.h:154</a></div></div>
<div class="ttc" id="astructbufferevent__private_html_a4431ae35ad587a64c9f557c4bad3fae3"><div class="ttname"><a href="structbufferevent__private.html#a4431ae35ad587a64c9f557c4bad3fae3">bufferevent_private::rate_limiting</a></div><div class="ttdeci">struct bufferevent_rate_limit * rate_limiting</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00218">bufferevent-internal.h:218</a></div></div>
<div class="ttc" id="astructbufferevent__private_html_a7d793f0632346c32119b818783b97c41"><div class="ttname"><a href="structbufferevent__private.html#a7d793f0632346c32119b818783b97c41">bufferevent_private::bev</a></div><div class="ttdeci">struct bufferevent bev</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00156">bufferevent-internal.h:156</a></div></div>
<div class="ttc" id="astructbufferevent__rate__limit__group_html"><div class="ttname"><a href="structbufferevent__rate__limit__group.html">bufferevent_rate_limit_group</a></div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00079">bufferevent-internal.h:79</a></div></div>
<div class="ttc" id="astructbufferevent__rate__limit__group_html_a273beb8e4c4660915ba76ec2e532378e"><div class="ttname"><a href="structbufferevent__rate__limit__group.html#a273beb8e4c4660915ba76ec2e532378e">bufferevent_rate_limit_group::n_members</a></div><div class="ttdeci">int n_members</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00109">bufferevent-internal.h:109</a></div></div>
<div class="ttc" id="astructbufferevent__rate__limit_html_ac7e81b36aedc37a0e403948168acc0f0"><div class="ttname"><a href="structbufferevent__rate__limit.html#ac7e81b36aedc37a0e403948168acc0f0">bufferevent_rate_limit::group</a></div><div class="ttdeci">struct bufferevent_rate_limit_group * group</div><div class="ttdef"><b>Definition:</b> <a href="bufferevent-internal_8h_source.html#l00139">bufferevent-internal.h:139</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bufferevent-internal_8h_source.html#l00156">bufferevent_private::bev</a>, <a class="el" href="bufferevent-internal_8h_source.html#l00485">BEV_LOCK</a>, <a class="el" href="bufferevent-internal_8h_source.html#l00069">BEV_SUSPEND_BW_GROUP</a>, <a class="el" href="bufferevent-internal_8h_source.html#l00491">BEV_UNLOCK</a>, <a class="el" href="bufferevent-internal_8h_source.html#l00478">BEV_UPCAST</a>, <a class="el" href="bufferevent_8c_source.html#l00078">bufferevent_unsuspend_read_()</a>, <a class="el" href="bufferevent_8c_source.html#l00100">bufferevent_unsuspend_write_()</a>, <a class="el" href="bufferevent-internal_8h_source.html#l00139">bufferevent_rate_limit::group</a>, <a class="el" href="bufferevent__ratelim_8c_source.html#l00185">LOCK_GROUP</a>, <a class="el" href="bufferevent-internal_8h_source.html#l00109">bufferevent_rate_limit_group::n_members</a>, <a class="el" href="bufferevent-internal_8h_source.html#l00218">bufferevent_private::rate_limiting</a>, and <a class="el" href="bufferevent__ratelim_8c_source.html#l00186">UNLOCK_GROUP</a>.</p>

<p class="reference">Referenced by <a class="el" href="bufferevent_8c_source.html#l00747">bufferevent_finalize_cb_()</a>, and <a class="el" href="bufferevent__ratelim_8c_source.html#l00781">bufferevent_remove_from_rate_limit_group()</a>.</p>

</div>
</div>
<a id="af7131ff343925cff5f5235ebbe6e332b" name="af7131ff343925cff5f5235ebbe6e332b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7131ff343925cff5f5235ebbe6e332b">&#9670;&nbsp;</a></span>ev_token_bucket_get_tick_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ev_uint32_t ev_token_bucket_get_tick_ </td>
          <td>(</td>
          <td class="paramtype">const struct timeval *&#160;</td>
          <td class="paramname"><em>tv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structev__token__bucket__cfg.html">ev_token_bucket_cfg</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >In which tick does 'tv' fall according to 'cfg'? Note that ticks can overflow easily; your code needs to handle this. </p>

<p class="definition">Definition at line <a class="el" href="bufferevent__ratelim_8c_source.html#l00127">127</a> of file <a class="el" href="bufferevent__ratelim_8c_source.html">bufferevent_ratelim.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  129</span>{</div>
<div class="line"><span class="lineno">  130</span>    <span class="comment">/* This computation uses two multiplies and a divide.  We could do</span></div>
<div class="line"><span class="lineno">  131</span><span class="comment">     * fewer if we knew that the tick length was an integer number of</span></div>
<div class="line"><span class="lineno">  132</span><span class="comment">     * seconds, or if we knew it divided evenly into a second.  We should</span></div>
<div class="line"><span class="lineno">  133</span><span class="comment">     * investigate that more.</span></div>
<div class="line"><span class="lineno">  134</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>    <span class="comment">/* We cast to an ev_uint64_t first, since we don&#39;t want to overflow</span></div>
<div class="line"><span class="lineno">  137</span><span class="comment">     * before we do the final divide. */</span></div>
<div class="line"><span class="lineno">  138</span>    ev_uint64_t msec = (ev_uint64_t)tv-&gt;tv_sec * 1000 + tv-&gt;tv_usec / 1000;</div>
<div class="line"><span class="lineno">  139</span>    return (<span class="keywordtype">unsigned</span>)(msec / cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a1f8abf6d3df9c1fcc06f6e61ab112fab">msec_per_tick</a>);</div>
<div class="line"><span class="lineno">  140</span>}</div>
<div class="ttc" id="astructev__token__bucket__cfg_html_a1f8abf6d3df9c1fcc06f6e61ab112fab"><div class="ttname"><a href="structev__token__bucket__cfg.html#a1f8abf6d3df9c1fcc06f6e61ab112fab">ev_token_bucket_cfg::msec_per_tick</a></div><div class="ttdeci">unsigned msec_per_tick</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00063">ratelim-internal.h:63</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ratelim-internal_8h_source.html#l00063">ev_token_bucket_cfg::msec_per_tick</a>.</p>

<p class="reference">Referenced by <a class="el" href="bufferevent__ratelim_8c_source.html#l00529">bev_group_refill_callback_()</a>, <a class="el" href="bufferevent__ratelim_8c_source.html#l00394">bev_refill_callback_()</a>, <a class="el" href="bufferevent__ratelim_8c_source.html#l00638">bufferevent_rate_limit_group_new()</a>, <a class="el" href="bufferevent__ratelim_8c_source.html#l00560">bufferevent_set_rate_limit()</a>, and <a class="el" href="bufferevent__ratelim_8c_source.html#l00114">bufferevent_update_buckets()</a>.</p>

</div>
</div>
<a id="a3efd9dbac768fc7d86cb77c688c8456d" name="a3efd9dbac768fc7d86cb77c688c8456d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3efd9dbac768fc7d86cb77c688c8456d">&#9670;&nbsp;</a></span>ev_token_bucket_init_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ev_token_bucket_init_ </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structev__token__bucket.html">ev_token_bucket</a> *&#160;</td>
          <td class="paramname"><em>bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structev__token__bucket__cfg.html">ev_token_bucket_cfg</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ev_uint32_t&#160;</td>
          <td class="paramname"><em>current_tick</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>reinitialize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Adjust 'bucket' to respect 'cfg', and note that it was last updated in 'current_tick'. If 'reinitialize' is true, we are changing the configuration of 'bucket'; otherwise, we are setting it up for the first time. </p>

<p class="definition">Definition at line <a class="el" href="bufferevent__ratelim_8c_source.html#l00050">50</a> of file <a class="el" href="bufferevent__ratelim_8c_source.html">bufferevent_ratelim.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   54</span>{</div>
<div class="line"><span class="lineno">   55</span>    <span class="keywordflow">if</span> (reinitialize) {</div>
<div class="line"><span class="lineno">   56</span>        <span class="comment">/* on reinitialization, we only clip downwards, since we&#39;ve</span></div>
<div class="line"><span class="lineno">   57</span><span class="comment">           already used who-knows-how-much bandwidth this tick.  We</span></div>
<div class="line"><span class="lineno">   58</span><span class="comment">           leave &quot;last_updated&quot; as it is; the next update will add the</span></div>
<div class="line"><span class="lineno">   59</span><span class="comment">           appropriate amount of bandwidth to the bucket.</span></div>
<div class="line"><span class="lineno">   60</span><span class="comment">        */</span></div>
<div class="line"><span class="lineno">   61</span>        <span class="keywordflow">if</span> (bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a25597241ef44a146e6f4ee16aa364470">read_limit</a> &gt; (ev_int64_t) cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a11bff520971dd30b7625b55b0e1bb1c3">read_maximum</a>)</div>
<div class="line"><span class="lineno">   62</span>            bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a25597241ef44a146e6f4ee16aa364470">read_limit</a> = cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a11bff520971dd30b7625b55b0e1bb1c3">read_maximum</a>;</div>
<div class="line"><span class="lineno">   63</span>        <span class="keywordflow">if</span> (bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a3f71fc8742913141e78f3495983175fe">write_limit</a> &gt; (ev_int64_t) cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a4a5a50a4b107c0d00efa574e52835fc1">write_maximum</a>)</div>
<div class="line"><span class="lineno">   64</span>            bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a3f71fc8742913141e78f3495983175fe">write_limit</a> = cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a4a5a50a4b107c0d00efa574e52835fc1">write_maximum</a>;</div>
<div class="line"><span class="lineno">   65</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   66</span>        bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a25597241ef44a146e6f4ee16aa364470">read_limit</a> = cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#aca34fb211d5a5f30f334e7edf3369220">read_rate</a>;</div>
<div class="line"><span class="lineno">   67</span>        bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a3f71fc8742913141e78f3495983175fe">write_limit</a> = cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a72a3a758c35fd9560a29740ef2cb7297">write_rate</a>;</div>
<div class="line"><span class="lineno">   68</span>        bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a33258d77678f877954d1d56f1910865d">last_updated</a> = current_tick;</div>
<div class="line"><span class="lineno">   69</span>    }</div>
<div class="line"><span class="lineno">   70</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   71</span>}</div>
<div class="ttc" id="astructev__token__bucket__cfg_html_a11bff520971dd30b7625b55b0e1bb1c3"><div class="ttname"><a href="structev__token__bucket__cfg.html#a11bff520971dd30b7625b55b0e1bb1c3">ev_token_bucket_cfg::read_maximum</a></div><div class="ttdeci">size_t read_maximum</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00052">ratelim-internal.h:52</a></div></div>
<div class="ttc" id="astructev__token__bucket__cfg_html_a4a5a50a4b107c0d00efa574e52835fc1"><div class="ttname"><a href="structev__token__bucket__cfg.html#a4a5a50a4b107c0d00efa574e52835fc1">ev_token_bucket_cfg::write_maximum</a></div><div class="ttdeci">size_t write_maximum</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00056">ratelim-internal.h:56</a></div></div>
<div class="ttc" id="astructev__token__bucket__cfg_html_a72a3a758c35fd9560a29740ef2cb7297"><div class="ttname"><a href="structev__token__bucket__cfg.html#a72a3a758c35fd9560a29740ef2cb7297">ev_token_bucket_cfg::write_rate</a></div><div class="ttdeci">size_t write_rate</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00054">ratelim-internal.h:54</a></div></div>
<div class="ttc" id="astructev__token__bucket__cfg_html_aca34fb211d5a5f30f334e7edf3369220"><div class="ttname"><a href="structev__token__bucket__cfg.html#aca34fb211d5a5f30f334e7edf3369220">ev_token_bucket_cfg::read_rate</a></div><div class="ttdeci">size_t read_rate</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00050">ratelim-internal.h:50</a></div></div>
<div class="ttc" id="astructev__token__bucket_html_a25597241ef44a146e6f4ee16aa364470"><div class="ttname"><a href="structev__token__bucket.html#a25597241ef44a146e6f4ee16aa364470">ev_token_bucket::read_limit</a></div><div class="ttdeci">ev_ssize_t read_limit</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00041">ratelim-internal.h:41</a></div></div>
<div class="ttc" id="astructev__token__bucket_html_a33258d77678f877954d1d56f1910865d"><div class="ttname"><a href="structev__token__bucket.html#a33258d77678f877954d1d56f1910865d">ev_token_bucket::last_updated</a></div><div class="ttdeci">ev_uint32_t last_updated</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00044">ratelim-internal.h:44</a></div></div>
<div class="ttc" id="astructev__token__bucket_html_a3f71fc8742913141e78f3495983175fe"><div class="ttname"><a href="structev__token__bucket.html#a3f71fc8742913141e78f3495983175fe">ev_token_bucket::write_limit</a></div><div class="ttdeci">ev_ssize_t write_limit</div><div class="ttdef"><b>Definition:</b> <a href="ratelim-internal_8h_source.html#l00041">ratelim-internal.h:41</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ratelim-internal_8h_source.html#l00044">ev_token_bucket::last_updated</a>, <a class="el" href="ratelim-internal_8h_source.html#l00041">ev_token_bucket::read_limit</a>, <a class="el" href="ratelim-internal_8h_source.html#l00052">ev_token_bucket_cfg::read_maximum</a>, <a class="el" href="ratelim-internal_8h_source.html#l00050">ev_token_bucket_cfg::read_rate</a>, <a class="el" href="ratelim-internal_8h_source.html#l00041">ev_token_bucket::write_limit</a>, <a class="el" href="ratelim-internal_8h_source.html#l00056">ev_token_bucket_cfg::write_maximum</a>, and <a class="el" href="ratelim-internal_8h_source.html#l00054">ev_token_bucket_cfg::write_rate</a>.</p>

<p class="reference">Referenced by <a class="el" href="bufferevent__ratelim_8c_source.html#l00638">bufferevent_rate_limit_group_new()</a>, and <a class="el" href="bufferevent__ratelim_8c_source.html#l00560">bufferevent_set_rate_limit()</a>.</p>

</div>
</div>
<a id="a47c8b7c18203a995cbbd368d3f997938" name="a47c8b7c18203a995cbbd368d3f997938"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47c8b7c18203a995cbbd368d3f997938">&#9670;&nbsp;</a></span>ev_token_bucket_update_()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ev_token_bucket_update_ </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structev__token__bucket.html">ev_token_bucket</a> *&#160;</td>
          <td class="paramname"><em>bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structev__token__bucket__cfg.html">ev_token_bucket_cfg</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ev_uint32_t&#160;</td>
          <td class="paramname"><em>current_tick</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >The current tick is 'current_tick': add bytes to 'bucket' as specified in 'cfg'. </p>

<p class="definition">Definition at line <a class="el" href="bufferevent__ratelim_8c_source.html#l00074">74</a> of file <a class="el" href="bufferevent__ratelim_8c_source.html">bufferevent_ratelim.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   77</span>{</div>
<div class="line"><span class="lineno">   78</span>    <span class="comment">/* It&#39;s okay if the tick number overflows, since we&#39;ll just</span></div>
<div class="line"><span class="lineno">   79</span><span class="comment">     * wrap around when we do the unsigned substraction. */</span></div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordtype">unsigned</span> n_ticks = current_tick - bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a33258d77678f877954d1d56f1910865d">last_updated</a>;</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>    <span class="comment">/* Make sure some ticks actually happened, and that time didn&#39;t</span></div>
<div class="line"><span class="lineno">   83</span><span class="comment">     * roll back. */</span></div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">if</span> (n_ticks == 0 || n_ticks &gt; INT_MAX)</div>
<div class="line"><span class="lineno">   85</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    <span class="comment">/* Naively, we would say</span></div>
<div class="line"><span class="lineno">   88</span><span class="comment">        bucket-&gt;limit += n_ticks * cfg-&gt;rate;</span></div>
<div class="line"><span class="lineno">   89</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">   90</span><span class="comment">        if (bucket-&gt;limit &gt; cfg-&gt;maximum)</span></div>
<div class="line"><span class="lineno">   91</span><span class="comment">            bucket-&gt;limit = cfg-&gt;maximum;</span></div>
<div class="line"><span class="lineno">   92</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">   93</span><span class="comment">       But we&#39;re worried about overflow, so we do it like this:</span></div>
<div class="line"><span class="lineno">   94</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    <span class="keywordflow">if</span> ((cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a11bff520971dd30b7625b55b0e1bb1c3">read_maximum</a> - bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a25597241ef44a146e6f4ee16aa364470">read_limit</a>) / n_ticks &lt; cfg-&gt;read_rate)</div>
<div class="line"><span class="lineno">   97</span>        bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a25597241ef44a146e6f4ee16aa364470">read_limit</a> = cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a11bff520971dd30b7625b55b0e1bb1c3">read_maximum</a>;</div>
<div class="line"><span class="lineno">   98</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   99</span>        bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a25597241ef44a146e6f4ee16aa364470">read_limit</a> += n_ticks * cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#aca34fb211d5a5f30f334e7edf3369220">read_rate</a>;</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>    <span class="keywordflow">if</span> ((cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a4a5a50a4b107c0d00efa574e52835fc1">write_maximum</a> - bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a3f71fc8742913141e78f3495983175fe">write_limit</a>) / n_ticks &lt; cfg-&gt;write_rate)</div>
<div class="line"><span class="lineno">  103</span>        bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a3f71fc8742913141e78f3495983175fe">write_limit</a> = cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a4a5a50a4b107c0d00efa574e52835fc1">write_maximum</a>;</div>
<div class="line"><span class="lineno">  104</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  105</span>        bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a3f71fc8742913141e78f3495983175fe">write_limit</a> += n_ticks * cfg-&gt;<a class="code hl_variable" href="structev__token__bucket__cfg.html#a72a3a758c35fd9560a29740ef2cb7297">write_rate</a>;</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    bucket-&gt;<a class="code hl_variable" href="structev__token__bucket.html#a33258d77678f877954d1d56f1910865d">last_updated</a> = current_tick;</div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  111</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ratelim-internal_8h_source.html#l00044">ev_token_bucket::last_updated</a>, <a class="el" href="ratelim-internal_8h_source.html#l00041">ev_token_bucket::read_limit</a>, <a class="el" href="ratelim-internal_8h_source.html#l00052">ev_token_bucket_cfg::read_maximum</a>, <a class="el" href="ratelim-internal_8h_source.html#l00050">ev_token_bucket_cfg::read_rate</a>, <a class="el" href="ratelim-internal_8h_source.html#l00041">ev_token_bucket::write_limit</a>, <a class="el" href="ratelim-internal_8h_source.html#l00056">ev_token_bucket_cfg::write_maximum</a>, and <a class="el" href="ratelim-internal_8h_source.html#l00054">ev_token_bucket_cfg::write_rate</a>.</p>

<p class="reference">Referenced by <a class="el" href="bufferevent__ratelim_8c_source.html#l00529">bev_group_refill_callback_()</a>, <a class="el" href="bufferevent__ratelim_8c_source.html#l00394">bev_refill_callback_()</a>, and <a class="el" href="bufferevent__ratelim_8c_source.html#l00114">bufferevent_update_buckets()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
